!function(){"use strict";function a(a,b){a.state("home",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).state("overview",{url:"/overview",templateUrl:"views/overview.html",controller:"OverviewCtrl",controllerAs:"ctrl"}),b.otherwise("/")}angular.module("cartaoFidelidadeApp",["ngResource","ui.router","ui.bootstrap"]).constant("RESTAPI",{url:"https://cartao-fidelidade.herokuapp.com"}).config(a),a.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function a(a){var b=this;b.fornecedores=a.query()}angular.module("cartaoFidelidadeApp").controller("MainCtrl",a),a.$inject=["Fornecedores"]}(),function(){"use strict";function a(a){var b=this;b.overviewData=a.query(function(a){b.overviewData={nome:"todos",children:a}},function(a){console.log("error")})}angular.module("cartaoFidelidadeApp").controller("OverviewCtrl",a),a.$inject=["Fornecedores"]}(),function(){"use strict";function a(a,b){return b(a.url+"/fornecedores/:id")}angular.module("cartaoFidelidadeApp").factory("Fornecedores",a),a.$inject=["RESTAPI","$resource"]}(),angular.module("cartaoFidelidadeApp").directive("overviewTreemap",["$window",function(a){var b={restrict:"E",replace:!1,scope:{grupos:"=chartData"},link:function(b,c,d){window.onresize=function(){b.$apply()},b.$watch("grupos",function(a,c){b.render(b.grupos)}),b.render=function(b){function d(){this.style("left",function(a){return a.x+"px"}).style("top",function(a){return a.y+"px"}).style("width",function(a){return Math.max(0,a.dx-1)+"px"}).style("height",function(a){return Math.max(0,a.dy-1)+"px"})}var e={top:40,right:10,bottom:10,left:10},f=960-e.left-e.right,g=500-e.top-e.bottom,h=a.d3,i=h.scale.category20c(),j=h.layout.treemap().size([f,g]).sticky(!0).value(function(a){return a.qtdLicitacoes}),k=h.select(c[0]).append("div").style("position","relative").style("width",f+e.left+e.right+"px").style("height",g+e.top+e.bottom+"px").style("left",e.left+"px").style("top",e.top+"px"),l=k.datum(b).selectAll(".node").data(j.nodes).enter().append("div").attr("class","node").call(d).style("background",function(a){return i(a.cnpjCpf)}).text(function(a){return a.children?null:a.nome});h.selectAll("input").on("change",function(){var a="count"===this.value?function(){return 1}:function(a){return a.qtdLicitacoes};l.data(j.value(a).nodes).transition().duration(1500).call(d)})}}};return b}]),function(){"use strict";function a(a){return{template:"",restrict:"E",scope:{dados:"="},link:function(b,c){for(var d=a.d3,e={top:0,right:0,bottom:0,left:0},f=100-e.left-e.right,g=2,h=[],i=0;i<b.dados.length;i++)h.push({data:[{month:"Aug",count:b.dados[i].indice}],name:b.dados[i].nomePartido});var h=(h.map(function(a){return a.name}),h.map(function(a){return a.data.map(function(a,b){return{y:a.count,x:a.month}})})),j=d.layout.stack();j(h);var h=h.map(function(a){return a.map(function(a){return{x:a.y,y:a.x,x0:a.y0}})}),k=d.select(c[0]).append("svg").attr({version:"1.1",viewBox:"0 0 "+(f+e.left+e.right)+" "+(g+e.top+e.bottom),width:"100%"}).append("g").attr("transform","translate("+e.left+","+e.top+")"),l=d.max(h,function(a){return d.max(a,function(a){return a.x+a.x0})}),m=d.scale.linear().domain([0,l]).range([0,f]),n=h[0].map(function(a){return a.y}),o=(d.scale.ordinal().domain(n).rangeRoundBands([0,g],.1),d.scale.ordinal().range(["#c0392b","#2980b9","#f1c40f","#27ae60","#7f8c8d"])),p=k.selectAll("g").data(h).enter().append("g").style("fill",function(a,b){return o(b)});p.selectAll("rect").data(function(a){return a}).enter().append("rect").attr("x",function(a){return m(a.x0)}).attr("y",0).attr("height",g).attr("width",function(a){return m(a.x)})}}}angular.module("cartaoFidelidadeApp").directive("cfLinhaPartidos",a),a.$inject=["$window"]}(),angular.module("cartaoFidelidadeApp").run(["$templateCache",function(a){"use strict";a.put("views/main.html",'<div class="row"> <div class="col-lg-8 col-lg-offset-2"> <h3 class="text-center">Fornecedores mais fiéis à partidos ou coligações</h3> <br><br> <div class="card" ng-repeat="fornecedor in main.fornecedores"> <div class="card-header"> <div class="card-title">{{fornecedor.nome}}</div> <div class="card-subtitle">CNPJ {{fornecedor.cnpjCpf}}</div> </div> <div class="card-body"></div> <div class="card-footer"> <cf-linha-partidos dados="fornecedor.fidelidade"></cf-linha-partidos> </div> </div> </div> </div>'),a.put("views/overview.html",'<form> <label><input type="radio" name="mode" value="size" checked> Size</label> <label><input type="radio" name="mode" value="count"> Count</label> </form> <overview-treemap chart-data="ctrl.overviewData"></overview-treemap>')}]);
