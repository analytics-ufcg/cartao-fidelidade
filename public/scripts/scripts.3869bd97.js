!function(){"use strict";function a(a,b){a.state("home",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).state("fornecedor",{url:"/fornecedor/:cpfCnpj",templateUrl:"views/fornecedor.html",controller:"FornecedorCtrl",controllerAs:"ctrl"}).state("overview",{url:"/overview",templateUrl:"views/overview.html",controller:"OverviewCtrl",controllerAs:"ctrl"}),b.otherwise("/")}angular.module("cartaoFidelidadeApp",["ngResource","ui.router","ui.bootstrap"]).constant("RESTAPI",{url:"https://cartao-fidelidade.herokuapp.com"}).config(a),a.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function a(a){function b(){c.fornecedores=a.ranked.query({ano:c.ano,tipo:c.tipo})}var c=this;c.fornecedores=[],c.getFornecedores=b,c.ano="2008",c.tipo="1",c.fornecedores=a.ranked.query({ano:c.ano,tipo:c.tipo})}angular.module("cartaoFidelidadeApp").controller("MainCtrl",a),a.$inject=["Fornecedores"]}(),function(){"use strict";function a(a,b){var c=this;c.fornecedor={},c.cpfCnpj=b.cpfCnpj,c.fornecedor=a.simples.get({cpfCnpj:c.cpfCnpj,ano:2008,tipo:1})}angular.module("cartaoFidelidadeApp").controller("FornecedorCtrl",a),a.$inject=["Fornecedores","$stateParams"]}(),function(){"use strict";function a(a){var b=this;b.overviewData=a.query(function(a){b.overviewData={nome:"todos",children:a}},function(a){console.log("error")})}angular.module("cartaoFidelidadeApp").controller("OverviewCtrl",a),a.$inject=["Fornecedores"]}(),function(){"use strict";function a(a,b){var c={ranked:b(a.url+"/ranked/fornecedores/:ano/:tipo"),simples:b(a.url+"/fornecedores/:cpfCnpj/:ano/:tipo")};return c}angular.module("cartaoFidelidadeApp").factory("Fornecedores",a),a.$inject=["RESTAPI","$resource"]}(),angular.module("cartaoFidelidadeApp").directive("overviewTreemap",["$window",function(a){var b={restrict:"E",replace:!1,scope:{grupos:"=chartData"},link:function(b,c,d){window.onresize=function(){b.$apply()},b.$watch("grupos",function(a,c){b.render(b.grupos)}),b.render=function(b){function d(){this.style("left",function(a){return a.x+"px"}).style("top",function(a){return a.y+"px"}).style("width",function(a){return Math.max(0,a.dx-1)+"px"}).style("height",function(a){return Math.max(0,a.dy-1)+"px"})}var e={top:40,right:10,bottom:10,left:10},f=960-e.left-e.right,g=500-e.top-e.bottom,h=a.d3,i=h.scale.category20c(),j=h.layout.treemap().size([f,g]).sticky(!0).value(function(a){return a.qtdLicitacoes}),k=h.select(c[0]).append("div").style("position","relative").style("width",f+e.left+e.right+"px").style("height",g+e.top+e.bottom+"px").style("left",e.left+"px").style("top",e.top+"px"),l=k.datum(b).selectAll(".node").data(j.nodes).enter().append("div").attr("class","node").call(d).style("background",function(a){return i(a.cnpjCpf)}).text(function(a){return a.children?null:a.nome});h.selectAll("input").on("change",function(){var a="count"===this.value?function(){return 1}:function(a){return a.qtdLicitacoes};l.data(j.value(a).nodes).transition().duration(1500).call(d)})}}};return b}]),function(){"use strict";function a(a){return{template:"",restrict:"E",scope:{dados:"="},link:function(b,c){for(var d=a.d3,e={top:0,right:0,bottom:0,left:0},f=100-e.left-e.right,g=2,h=[],i=0;i<b.dados.length;i++)h.push({data:[{month:"Aug",count:b.dados[i].indice}],name:b.dados[i].nomePartido});var h=(h.map(function(a){return a.name}),h.map(function(a){return a.data.map(function(a,b){return{y:a.count,x:a.month}})})),j=d.layout.stack();j(h);var h=h.map(function(a){return a.map(function(a){return{x:a.y,y:a.x,x0:a.y0}})}),k=d.select(c[0]).append("svg").attr({version:"1.1",viewBox:"0 0 "+(f+e.left+e.right)+" "+(g+e.top+e.bottom),width:"100%"}).append("g").attr("transform","translate("+e.left+","+e.top+")"),l=d.max(h,function(a){return d.max(a,function(a){return a.x+a.x0})}),m=d.scale.linear().domain([0,l]).range([0,f]),n=h[0].map(function(a){return a.y}),o=(d.scale.ordinal().domain(n).rangeRoundBands([0,g],.1),d.scale.ordinal().range(["#c0392b","#2980b9","#f1c40f","#27ae60","#7f8c8d"])),p=k.selectAll("g").data(h).enter().append("g").style("fill",function(a,b){return o(b)});p.selectAll("rect").data(function(a){return a}).enter().append("rect").attr("x",function(a){return m(a.x0)}).attr("y",0).attr("height",g).attr("width",function(a){return m(a.x)})}}}angular.module("cartaoFidelidadeApp").directive("cfLinhaPartidos",a),a.$inject=["$window"]}(),function(){"use strict";function a(a){return{template:"",restrict:"E",scope:{dados:"="},link:function(b,c){var d=a.d3,e={top:20,right:20,bottom:30,left:40},f=960-e.left-e.right,g=500-e.top-e.bottom,h=d.scale.linear().range([0,f]),i=d.scale.linear().range([g,0]),j=d.scale.category10(),k=d.svg.axis().scale(h).orient("bottom"),l=d.svg.axis().scale(i).orient("left"),m=d.select(c[0]).append("svg").attr({version:"1.1",viewBox:"0 0 "+(f+e.left+e.right)+" "+(g+e.top+e.bottom),width:"100%"}).append("g").attr("transform","translate("+e.left+","+e.top+")");d.tsv("data.tsv",function(a,b){if(a)throw a;b.forEach(function(a){a.sepalLength=+a.sepalLength,a.sepalWidth=+a.sepalWidth}),h.domain(d.extent(b,function(a){return a.sepalWidth})).nice(),i.domain(d.extent(b,function(a){return a.sepalLength})).nice(),m.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(k).append("text").attr("class","label").attr("x",f).attr("y",-6).style("text-anchor","end").text("Sepal Width (cm)"),m.append("g").attr("class","y axis").call(l).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Sepal Length (cm)"),m.selectAll(".dot").data(b).enter().append("circle").attr("class","dot").attr("r",3.5).attr("cx",function(a){return h(a.sepalWidth)}).attr("cy",function(a){return i(a.sepalLength)}).style("fill",function(a){return j(a.species)});var c=m.selectAll(".legend").data(j.domain()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"});c.append("rect").attr("x",f-18).attr("width",18).attr("height",18).style("fill",j),c.append("text").attr("x",f-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a})})}}}angular.module("cartaoFidelidadeApp").directive("cfFornecedorPlot",a),a.$inject=["$window"]}(),function(){"use strict";function a(a,b){return{template:"",restrict:"E",scope:{cpfCnpj:"="},link:function(c,d){function e(){p.attr("transform","translate("+h.event.translate+")scale("+h.event.scale+")")}function f(a,b){var c=i.feature(a,a.objects.municipios),d=(h.scale.category20b(),h.scale.quantize().domain([0,1e3]).range(h.range(9).map(function(a){return"q"+a+"-9"})));o.selectAll(".municipio").data(c.features).enter().append("path").attr("id",function(a){return a.id}).attr("class",function(a){var b=a.properties.nome.toLowerCase().replace(" ","").replace("'","");return"municipio-"+b}).attr("d",m);for(var e=0;e<b.fidelidade.length;e++){var f=b.fidelidade[e].municipio.toLowerCase().replace(" ","").replace("'","");o.select(".municipio-"+f).classed(d(b.fidelidade[e].valor),!0)}}function g(a,b,c){return a?console.error(a):void f(b,c)}console.log(c.cpfCnpj);var h=a.d3,i=a.topojson,j=800,k=400,l=h.geo.mercator().scale(9e3).translate([7.7*j,-2.3*k]),m=h.geo.path().projection(l),n=h.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,8]).on("zoom",e),o=h.select(d[0]).append("svg").attr({version:"1.1",viewBox:"0 0 "+j+" "+k,width:"100%","class":"svg-map"}).call(n),p=o.append("g").attr("id","g-map");h.queue().defer(h.json,"scripts/municipios.json").defer(h.json,b.url+"/fornecedores/"+c.cpfCnpj+"/2008/1").await(g)}}}angular.module("cartaoFidelidadeApp").directive("cfFornecedorMapa",a),a.$inject=["$window","RESTAPI"]}(),angular.module("cartaoFidelidadeApp").run(["$templateCache",function(a){"use strict";a.put("views/fornecedor.html",'<h3>{{ctrl.fornecedor.nome}}</h3> <p>CPF/CNPJ: {{ctrl.fornecedor.cpfCnpj}}</p> <br><br> <cf-fornecedor-mapa cpf-cnpj="ctrl.cpfCnpj"></cf-fornecedor-mapa>'),a.put("views/main.html",'<div class="row"> <div class="col-lg-8 col-lg-offset-2"> <br><br> <h3 class="text-center">Fornecedores mais fiéis a municípios da Paraíba</h3> <div class="row"> <div class="col-sm-6 col-sm-offset-3"> <select class="form-control" ng-model="main.ano" ng-change="main.getFornecedores()"> <option value="2008">Legislatura de 2008 à 2012</option> <option value="2012">Legislatura de 2012 à 2016</option> </select> <br> <select class="form-control" ng-model="main.tipo" ng-change="main.getFornecedores()"> <option value="1">Mais licitações ganhas</option> <option value="2">Maior valor total de licitações ganhas</option> </select> </div> </div>  <br><br> <div class="card" ng-repeat="fornecedor in main.fornecedores"> <div class="card-header"> <div class="row"> <div class="col-sm-8"> <div class="card-title">{{fornecedor.nome}}</div> <div class="card-subtitle">CNPJ {{fornecedor.cpfCnpj}}</div> </div> <div class="col-sm-4"> <p class="text-right">{{fornecedor.numEmpenhos}} licitações ganhas</p> <p class="text-right">{{fornecedor.valorEmpenhos | currency:\'R$ \'}}</p> </div> </div> <div class="row"> <div class="col-sm-4 col-sm-offset-8 col-lg-3 col-lg-offset-9"> <a ui-sref="fornecedor({cpfCnpj: fornecedor.cpfCnpj})" class="btn btn-block btn-primary"> <span class="glyphicon glyphicon-eye-open"></span> Detalhes </a> </div> </div> </div> <div class="card-body"></div> <div class="card-footer"> </div> </div> </div> </div>'),a.put("views/overview.html",'<form> <label><input type="radio" name="mode" value="size" checked> Size</label> <label><input type="radio" name="mode" value="count"> Count</label> </form> <overview-treemap chart-data="ctrl.overviewData"></overview-treemap>')}]);